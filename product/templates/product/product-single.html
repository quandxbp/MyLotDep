{% extends "base-no-main.html" %}
{% load  static %}

{% block content %}
    <section id="home-slider" class="home-slider">
        <div class="slider-item">
            <div class="overlay"></div>
                <div class="container">
                    <div class="row slider-text align-items-center justify-content-center">
                        <div class="col-md-14 ftco-animate text-center">
                            <div class="subscribe-form mb-4">
                                <div class="form-group">
                                    <span class="icon icon-search"></span>
                                    <input type="search" placeholder="Tìm theo dường dẫn hoặc tên sản phẩm ..." class="product-search form-control">
                                </div>
                            </div>
                            <h5 class="mb-4">Từ khóa nổi bật:
                                <strong>
                                    <a>Galaxy Note 10</a>,
                                    <a>iPhone 11</a>
                                </strong>
                            </h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- END slider -->

    <section id="single-product" class="ftco-section cust-border-top">
        <div class="container">
            <div class="row">
                <div id="display-thumbnail" class="cust-border-right col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <img id="product-thumbnail" class="product-thumbnail"
                             src="{{ product.thumbnail_url }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="text-center">
                                <small >
                                    <i class="fa fa-search-plus"></i> Rê chuột lên hình để phóng to
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                {# Main content #}
                <div id="product-detail" class="col-xl-9 col-lg-8 col-md-6 col-sm-12 ">
                    <div id="product-thumbnail-zoom" class="img-zoom-result"></div>
                    <div class="row p-2">
                        <div class="col-md-12">
                            <div class="text display-product-main-info cust-border-bottom">
                                <div class="row">
                                    <h2 id="product-name pl-3">{{ product.name }}
                                    </h2>
                                </div>
                                <div class="row">
                                    <div class="col-md-5 p-2">
                                        <label class="product-vendor-label">Nhà cung cấp: &nbsp;</label>
                                        <a href="#">
                                            <span class="blue-color" id="product-vendor">Tiki Trading</span>
                                        </a>
                                        <label class="ml-4 product-brand-label">Thương hiệu: &nbsp;</label>
                                        <a href="#">
                                            <span class="blue-color" id="product-brand">{{ product.brand_id.name }}</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row p-2 display-price">
                        {# Price #}
                        <div class="col-md-5">
                            <div class="row p-2">
                                <h3>
                                    <strong class="price red-color sale-price" id="sale-price" >{{ product.sale_price }}</strong>
                                    <img class="logo ml-4" src="{% static 'images/tiki.png' %}" >
                                </h3>
                            </div>
                            <div class="row pl-2">
                                <label class="discount-label">Giảm giá: &nbsp;</label>
                                <span class="red-color" id="discount-percent"> {{ product.discount_rate }}% &nbsp;</span>
                                (<span class="price" id="discount-amount pl-2">{{ product.discount }}</span>)
                            </div>
                            <div class="row pl-2 cust-border-bottom">
                                <label class="list-price-label">Giá gốc: &nbsp;</label>
                                <span id="list-price" class="price list-price">{{ product.list_price }}</span>
                            </div>
                            <div class="row p-2 pt-4">
                                <a id="product-link" class="solid-btn p-2 pr-3" href="#">
                                    <i class="fa fa-shopping-cart fa-2x"></i>&nbsp; ĐẾN NGAY NƠI BÁN
                                </a>
                            </div>
                        </div>
                        {# /Price #}
                        <div class="col-md-7">
                            <div id="other-seller" class="row">
                                <div id="seller-list">
                                    <h5 class="pt-3 pl-3">NHÀ CUNG CẤP KHÁC</h5>
                                    <ul>
                                        <li class="small">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <a class="seller-name" href="#">VinPro - Thuộc tập đoàn Vingroup</a>
                                                </div>
                                                <div class="col-md-3">
                                                    <p><span class="price red-color">22.900.000</span></p>
                                                </div>
                                                <div class="col-md-3">
                                                    <a class="solid-btn detail-btn ml-4 pt-1 pb-1 pl-2 pr-2" href="#">
                                                        Chi tiết
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="pl-5 row">
                                                <p><i class="fa fa-star"></i> Rẻ hơn <span class="price pink-color">130.000</span></p>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {# /Main content #}

            </div>
        </div>
    </section>

    <section id="middle-page" class="ftco-section">
        <div class="container cust-border-top">
            <div class="row">
                <div class="col-md-8" id="price-history">
                    <canvas id="canvas"></canvas>
                </div>
                {# Specification #}
                <div class="col-md-4" id="specification">
                    <div class="row cust-border-left">
                        <div id="spec-detail" class="col-md-12">
                            <h5 class="text-center pt-3 pl-3">THÔNG SỐ KỸ THUẬT</h5>
                            <ul>
                                {% for sp in specifications %}
                                    {% if forloop.counter0|divisibleby:2 == 0 %}
                                        <li>
                                            <div class="row pt-1 pb-1 background-grey">
                                                <div class="sp-name blue-color col-md-6">
                                                    {{ sp.name }}
                                                </div>
                                                 <div class="sp-value col-md-6">
                                                     {{ sp.value }}
                                                 </div>
                                            </div>
                                        </li>
                                    {% else %}
                                        <li>
                                            <div class="row pt-1 pb-1">
                                                <div class="sp-name blue-color col-md-6">
                                                    {{ sp.name }}
                                                </div>
                                                 <div class="sp-value col-md-6">
                                                     {{ sp.value }}
                                                 </div>
                                            </div>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="col-md-12">
                            <div class="text-center">
                                <a class="empty-btn detail-btn pt-1 pb-1 pl-3 pr-3" href="#">
                                    Xem thêm
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {# /Specification #}
            </div>
        </div>
    </section>

    <section id="product-description" class="ftco-section">
        <div class="container cust-border-top">
            <div class="row" style="height: 400px;">
            </div>
        </div>
    </section>

    <script>
        function formatPriceValue(price) {
            let newPrice = price.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.') + " ₫";
            return newPrice
        }

		var labels = [{% for label in labels %} new Date("{{ label }}").toLocaleDateString('en-GB'),{% endfor %}];
        var predict_labels = [
        new Date("10-05-2019").toLocaleDateString('en-GB'),
        new Date("10-06-2019").toLocaleDateString('en-GB'),
        new Date("10-07-2019").toLocaleDateString('en-GB'),
        new Date("10-08-2019").toLocaleDateString('en-GB'),
        new Date("10-09-2019").toLocaleDateString('en-GB'),
        new Date("10-10-2019").toLocaleDateString('en-GB')];
        labels = labels.concat(predict_labels);

        var prices = [{% for price in prices %}{{ price }}, {% endfor %}];
        var predict = [1970977, 1973498, 1975594, 1977028, 1976441, 1974869];
        var predict_prices = prices.concat(predict);

        var config = {
			type: 'line',
			data: {
				labels: labels,
				datasets: [{
					label: 'Giá biến động theo thời gian',
					backgroundColor: window.chartColors.red,
					borderColor: window.chartColors.red,
					data: prices,
					fill: false,
				},{
					label: 'Giá dự đoán',
					backgroundColor: window.chartColors.blue,
					borderColor: window.chartColors.blue,
					data: predict_prices,
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'LỊCH SỬ GIÁ',
                    fontSize: 25,
                    fontColor: "#111",
				},
				tooltips: {
				    enabled: true,
					mode: 'single',
					intersect: false,
                    callbacks: {
                    label: function(tooltipItems, data) {
                        var multistringText = [];
                            multistringText.push("Giá: " + formatPriceValue(tooltipItems.yLabel));
                        return multistringText;
                    }
                }
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
                            fontSize: 16,
							labelString: 'Thời điểm'
						}
					}],
					yAxes: [{
						display: true,
                        ticks: {
                            callback: function(label, index, labels) {
                                return label.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.') + " ₫";
                            }
                        },
						scaleLabel: {
							display: true,
                            fontSize: 16,
							labelString: 'Giá tại thời điểm'
						}
					}]
				}
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);
		};

	</script>
{% endblock %}




